<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,member-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link href="__ADMIN__css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>添加商品</title>
</head>
<body>
<div class="pd-20">
  <form action="{:U('Supplier/addGoods')}" method="post" enctype="multipart/form-data" class="form form-horizontal" id="form-member-add">
    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>供应商：</label>
      <div class="formControls col-9">
        <select name="supplier_id">
          <volist name="users" id="user">
          <option value="{$user['supplier_id']}">{$user['company_name']}</option>
          </volist>
        </select>
      </div>

    </div>
    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>主编码：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="bn" name="bn" datatype="*2-32"  nullmsg="请输入主编码">
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>条形码：</label>
      <div class="formControls col-5 skin-minimal">
        <input type="text" class="input-text" value="" placeholder="" id="barcode" name="barcode" >
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>生产公司名称：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="company_name" name="company_name" datatype="*2-255" nullmsg="请输入公司名称">
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">商品名称：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="title" name="title" datatype="*2-128"  nullmsg="请输入商品名称">
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">产地：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="origin" name="origin">
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">结算价：</label>
      <div class="formControls col-1">
        <input type="number" step="0.01" class="input-text"  onchange="edit_profit_rate()" value="0.00" placeholder="" id="cost_price" name="cost_price" datatype="*"  nullmsg="请输入结算价">
      </div>
      <label class="form-label col-1">建议价：</label>
      <div class="formControls col-1">
        <input type="number" step="0.01" class="input-text" onchange="edit_profit_rate()"  value="0.00" placeholder="" id="mkt_price" name="mkt_price" datatype="*"  nullmsg="请输入销售价">
      </div>
      <label class="form-label col-1">京东价格：</label>
      <div class="formControls col-1">
        <input type="number" step="0.01" class="input-text"  value="0.00" placeholder="" id="jd_price" name="jd_price" >
      </div>
      <div class="col-4"> </div>
    </div>

    <div class="row cl">
      <label class="form-label col-3">分类：</label>
      <div class="formControls col-9">
          <span class=" col-3" style="float:left;" >
				<select name="cat_id_1" id="cat_1" class="select col-3">
                  <option value="0">请选择一级分类</option>
                  <volist name="cat_1" id="cat">
                   <option value="{$cat['cat_id']}">{$cat['cat_name']}</option>
                  </volist>
                </select>
          </span>
          <span class=" col-3" style="float:left;">
				<select name="cat_id_2" id="cat_2" class="select col-3">
                  <option value="0">请选择二级分类</option>
                </select>
          </span>
                  <span class=" col-3" style="float:left;">
				<select name="cat_id" id="cat_3" class="select col-3" datatype="*"  nullmsg="请选择分类">
                  <option value="0">请选择三级分类</option>
                </select>
          </span>
      </div>
    </div>

    <div class="row cl">
      <label class="form-label col-3"><span class="c-red">*</span>品牌：</label>
      <div class="formControls col-5">
        <select name="brand_id" id="brand_list" datatype="*"  nullmsg="请选择品牌">
          <volist name="brands" id="brand">
            <option value="{$brand['brand_id']}">{$brand['brand_name']}</option>
          </volist>
        </select>

      </div>        <div><input type="button" onclick="add_brand()" class="btn btn-success" value="新增品牌"/></div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">进项税：</label>
      <div class="formControls col-1">
        <input type="number" step="0.1" class="input-text" value="0.17" placeholder="" id="input_tax" name="input_tax"  >
      </div>
      <label class="form-label col-1">销项税：</label>
      <div class="formControls col-1">
        <input type="number" step="0.1" class="input-text" value="0.17" placeholder="" id="output_tax" name="output_tax"  >
      </div>
    </div>

    <div class="row cl">
      <label class="form-label col-3">包装单位：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="unit" name="unit">
      </div>
      <div class="col-4"> </div>
    </div>


    <div class="row cl">
      <label class="form-label col-3">保质期：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text" value="" placeholder="" id="shelf_life" name="shelf_life">
      </div>
      <div class="col-4"> </div>
    </div>

    <div class="row cl">
      <label class="form-label col-3">箱包数：</label>
      <div class="formControls col-2">
        <input type="text" class="input-text" value="" placeholder="" id="case_num" name="case_num">
      </div>
      <label class="form-label col-1">运费：</label>
      <div class="formControls col-4">
        <input type="number" step="0.01"  class="input-text col-12" value="" placeholder="" id="freight" name="freight">
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">合作方式：</label>
      <div class="formControls col-2">
        <input type="text" class="input-text" value="" placeholder="" id="cooperation_method" name="cooperation_method">
      </div>
      <label class="form-label col-1">结算方式：</label>
      <div class="formControls col-2">
        <input type="text" class="input-text" value="" placeholder="" id="settlement_method" name="settlement_method">
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">

      <div class="col-4"> </div>
    </div>


    <input type="hidden" step="0.01" class="input-text" style="width:50%;" value="0.00" placeholder="" id="profit_rate" name="profit_rate" datatype="*"  >

    <div class="row cl">
      <label class="form-label col-3">重量(kg)：</label>
      <div class="formControls col-5">
        <input type="number"  class="input-text" value="" style="width:50%;" placeholder="" id="weight" name="weight">
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">长(cm)：</label>
      <div class="formControls col-1">
        <input type="number" class="input-text" value="" style="width:100%;" placeholder="" id="length" name="length">
      </div>
      <label class="form-label col-1">宽(cm)：</label>
      <div class="formControls col-1">
        <input type="number" class="input-text" style="width:100%;"  value="" placeholder="" id="width" name="width">
      </div>
      <label class="form-label col-1">高(cm)：</label>
      <div class="formControls col-1">
        <input type="number" class="input-text" value="" style="width:100%;" placeholder="" id="height" name="height">
      </div>
      <div class="col-4"> </div>
    </div>

    <div class="row cl">
      <label class="form-label col-3">货期：</label>
      <div class="formControls col-5">
        <input type="text" class="input-text  col-12" value="" placeholder="" id="delivery_period" name="delivery_period">
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-3">代发自发：</label>
      <div class="formControls col-5 skin-minimal">
        <div class="radio-box">
          <input type="radio" id="send_type" value="1" name="send_type" checked="checked">
          <label for="send_type">自发</label>
        </div>
        <div class="radio-box">
          <input type="radio" id="send_type2" value="2" name="send_type">
          <label for="send_type2">代发</label>
        </div>
      </div>
      <div class="col-4"> </div>
    </div>
    <div class="row cl">
      <div class="col-9 col-offset-3">
        <input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
      </div>
    </div>
  </form>
</div>
</div>
<script type="text/javascript" src="__ADMIN__lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__ADMIN__lib/icheck/jquery.icheck.min.js"></script>
<script type="text/javascript" src="__ADMIN__lib/Validform/5.3.2/Validform.min.js"></script>
<script type="text/javascript" src="__ADMIN__lib/layer/1.9.3/layer.js"></script>
<script type="text/javascript" src="__ADMIN__js/H-ui.js"></script>
<script type="text/javascript" src="__ADMIN__js/H-ui.admin.js"></script>
<script type="text/javascript">
$(function(){
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
  layer.config({
    extend: 'extend/layer.ext.js'
  });
	$("#form-member-add").Validform({
		tiptype:2,
		callback:function(form){
			form[0].submit();
			var index = parent.layer.getFrameIndex(window.name);
			parent.$('.btn-refresh').click();
			parent.layer.close(index);
		}
	});
  $('#cat_1').change(function(){
      var cat_1=$('#cat_1').val();
      url="{:U('Supplier/getCat','','')}/cat_id/"+cat_1;
    $.get(url,"", function (text) {
      var cat=$('#cat_2');
      set_cat_2(cat,text);
    });
  });
  $('#cat_2').change(function(){
    var cat_1=$('#cat_2').val();
    url="{:U('Supplier/getCat','','')}/cat_id/"+cat_1;
    $.get(url,"", function (text) {
      var cat=$('#cat_3');
      set_cat_2(cat,text);
    });
  });
  function set_cat_2(cat,obj){
   // var cat = $('#cat_2');
    cat.empty();
    for( val in obj){
      cat.append("<option value='"+obj[val].cat_id+"'>"+obj[val].cat_name+"</option>");
    }
  }
});
function edit_profit_rate(){
  var cost=parseFloat($("#cost_price").val());
  var price=parseFloat($("#mkt_price").val());
  var profit=$("#profit_rate");
  var val=(price-cost)/price;
  val=val.toFixed(2);
  profit.val(val);

}
function set_cat_brand(cat,obj){
  cat.empty();
  for( val in obj){
    cat.append("<option value='"+obj[val].brand_id+"'>"+obj[val].brand_name+"</option>");
  }
}
function add_cat_brand(cat,obj){
    cat.append("<option value='"+obj.brand_id+"'>"+obj.brand_name+"</option>");
}
$('#cat_3').change(function(){
  var cat_1=$('#cat_3').val();
  url="{:U('Supplier/getBrandByCat','','')}/cat_id/"+cat_1;
  $.get(url,"", function (text) {
    var cat=$('#brand_list');
    set_cat_brand(cat,text);
  });
});

function add_brand(cat_id){
  layer.prompt({
    title: '输入品牌名称',
    formType: 0 //prompt风格，支持0-2
  }, function(pass){
    url="{:U('Supplier/addBrand','','')}";
    var json={'brand_name':pass,'cat_id':$('#cat_3').val()};
    $.post(url,json, function (text) {
      layer.closeAll();
      if(text=="0"){
        layer.msg("添加失败");
      }else{
        var cat=$('#brand_list');
        add_cat_brand(cat,text);
        layer.msg("添加成功");
      }


    });


  });
}


</script>
</body>
</html>