<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="__ADMIN__lib/html5.js"></script>
<script type="text/javascript" src="__ADMIN__lib/respond.min.js"></script>
<script type="text/javascript" src="__ADMIN__lib/PIE_IE678.js"></script>
<![endif]-->
<link href="__ADMIN__css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN__lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="__ADMIN__lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>新增图片</title>
<style>
	.checkSku{
		border: 1px solid #5a98de;border-radius: 5px;font-size: 12px;background-color: #5A98DE;color: white;padding: 5px 10px;		
	}
	.itemIdTxt{
		text-align: left;
	}
	.itemInfo{
		text-align: left;border:1px solid #5a98de;border-radius: 4px;margin: 2px 0px;padding: 5px 0px;font-size: 12px;margin-top: 20px;
	}
</style>
</head>
<body>
<div class="pd-20">
<nav class="breadcrumb"><a class="btn btn-success radius r mr-20" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
	
	<form action="{:U('Home/Activity/updateAItemDeal')}" method="post" enctype="multipart/form-data" class="form form-horizontal" id="form-article-add">
		<present name="info.aitem_id">
			<input type="text" name="aitemId" value="{$info.aitem_id}" />
		</present>
		<input type="hidden" name="data[aid]" value="{$aid}" />
		<input type="hidden" name="data[activity_config_id]" value="{$activityId}" />
		<div class="row cl" style="color: red;;">
			<p>*填入或更改skuId时"务必"单击校验,单击校验后生成的售价和预备库存的值为手动填入的参考的最大值</p>
		</div>		    
		<div class="row cl">
			<label class="col-12">添加活动商品：</label>
			<div class="formControls col-12">
				<div class="formControls col-12">
					<div class="form-label col-11">
						<div class="form-label col-5">
							<label class="form-label col-4">skuid：</label>
							<div class="formControls col-4" >
								<input type="text" class="input-text skuId" id="skuId" value="{$info[parent_sku_id]}" placeholder="skuid" name="data[parent_sku_id]"  onkeyup="this.value=this.value.replace(/[^\d]/g,'')" <present name="info.aitem_id">disabled</present>  >
							</div>							
							<div class="form-label col-4">
								<notpresent name="info.aitem_id">
									<a href="javascript:void(0)" class="checkSku" >
										校验
									</a>								
								</notpresent>
							</div>						
						</div>
						<div class="form-label col-7">
								<input type="text" class="input-text" id="skuName" value="" placeholder="skuid" name="data[spec_info]"  >
						</div>
					</div>
				</div>
				<div class="row formControls col-12">
					<div class="form-label col-11">
						<div class="form-label col-4">
							<label class="form-label col-4">进货价：</label>
							<div class="formControls col-6" >
								<input type="text" class="input-text price" id="costPrice" value="{$info[cost_price]}" placeholder="进货价" name="data[cost_price]" onkeyup="clearNoNum(this)"  >
							</div>	
							元
						</div>
						<div class="form-label col-4">
							<label class="form-label col-4">售价：</label>
							<div class="formControls col-6" >
								<input type="text" class="input-text price" id="price" value="{$info[price]}" placeholder="活动的商品的售价" name="data[price]" onkeyup="clearNoNum(this)"  >
							</div>	
							元
						</div>
						<div class="form-label col-4">
							<label class="form-label col-7">预备库存：</label>
							<div class="formControls col-5" >
								<input type="text" class="input-text" id="store" value="{$info[store]}" placeholder="数量/件" name="data[store]" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" >
							</div>	
						</div>	
					</div>
				</div>				
			</div>
		</div>	
		<div class="col-12 skuRes">
		
		</div>						
		<div class="row cl" style="bottom: 10px;position: fixed;">
			<div class="col-8 col-offset-4">
				<button type="submit" class="btn btn-success radius" type="button">&nbsp;&nbsp;保存&nbsp;&nbsp;</button>
				<button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
</div>
</div>
<script type="text/javascript" src="__ADMIN__lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="__ADMIN__lib/layer/1.9.3/layer.js"></script> 
<script type="text/javascript" src="__ADMIN__lib/My97DatePicker/WdatePicker.js"></script> 
<script type="text/javascript" src="__ADMIN__lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="__ADMIN__lib/Validform/5.3.2/Validform.min.js"></script> 
<script type="text/javascript" src="__ADMIN__lib/webuploader/0.1.5/webuploader.min.js"></script> 
<script type="text/javascript" src="__ADMIN__lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__ADMIN__lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__ADMIN__lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" src="__ADMIN__js/H-ui.js"></script> 
<script type="text/javascript" src="__ADMIN__js/H-ui.admin.js"></script> 
<script type="text/javascript">
$(function(){
	var skuId = $('#skuId').val();
	if(skuId > 0){
		checkSkuInfo(skuId);
	}
});
$(".checkSku").on('click',function(){
	var skuId = $('#skuId').val();
	checkSkuInfo(skuId);
});
//校验商品
function checkSkuInfo(skuId){
	if(!skuId){
		layer.msg("请输入skuId");
		return false;
	}
	$.get('__APP__/Activity/getSkuCon',{skuId:skuId},function(data){
		if(data){
			var store = data['store']-data['freez'];
			<notpresent name="info.aitem_id">
				$("#price").val(data['price']);
				$("#store").val(store);
				$("#skuName").val(data['spec_info']);
				$("#costPrice").val(data['cost_price']);
			</notpresent>			
			var skuInfo = '';
				skuInfo +='		<div class="col-12 itemInfo">';
				skuInfo +='		<div class="col-2">';
				skuInfo +='<img src="'+data['image_default_id']+'" style="width:80px;heigt:80px;"/>';
				skuInfo +='		</div>';
				skuInfo +='		<div class="col-10">';
				skuInfo +='			<div class="col-12">skuId:'+data['sku_id']+';商品Id:'+data['item_id']+'</div>';
				skuInfo +='			<div class="col-12">'+data['title']+'</div>';
				skuInfo +='			<div class="col-12">';
				skuInfo +='规格:'+data['spec_info']+';价格：'+data['price']+'元 ;成本价：'+data['cost_price']+'元';
				skuInfo +='			</div>';
				skuInfo +='			<div class="col-12">';
				skuInfo +='库存:'+data['store']+'  ;预占库存：'+data['freez']+' ;可作为活动库存的最大值为（预备库存框值最多追加）：'+store;
				skuInfo +='			</div>';				
				skuInfo +='		</div>';				
				skuInfo +='		</div>';				
			$('.skuRes').html(skuInfo);
		}else{
			layer.msg("skuId有误！");
		}
	});
}
</script>
</body>
</html>